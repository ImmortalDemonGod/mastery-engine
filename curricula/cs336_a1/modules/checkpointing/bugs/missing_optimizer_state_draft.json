{
  "id": "checkpointing-missing-optimizer-state",
  "description": "Removes the optimizer state from the checkpoint, causing training to restart poorly.",
  "injection_type": "ast",
  "engine_version": "2.1",
  "target_function": "save_checkpoint",
  "logic": [
    {
      "pass_": 1,
      "type": "find_and_replace",
      "description": "Delete the optimizer state from the checkpoint dictionary.",
      "pattern": {
        "node_type": "Assign",
        "targets": [
          {
            "node_type": "Name",
            "id": "checkpoint"
          }
        ],
        "value": {
          "node_type": "Dict",
          "op": null,
          "attr": null
        },
        "attr": null,
        "op": null,
        "func": null,
        "left": null,
        "right": null,
        "args": null,
        "keywords": [
          {
            "arg": "optimizer_state_dict",
            "value": {
              "node_type": "Call",
              "op": null,
              "attr": null
            }
          }
        ]
      },
      "conditions": null,
      "track_as": null,
      "replacement": {
        "type": "replace_value_with",
        "source": "{\"model_state_dict\": model.state_dict(), \"iteration\": int(iteration)}",
        "name": null
      }
    },
    {
      "pass_": 2,
      "type": "find_and_replace",
      "description": "Remove the optimizer state loading from the checkpoint.",
      "pattern": {
        "node_type": "Expr",
        "targets": null,
        "value": {
          "node_type": "Call",
          "op": null,
          "attr": null
        },
        "attr": null,
        "op": null,
        "func": {
          "node_type": "Attribute",
          "op": null,
          "attr": "load_state_dict"
        },
        "left": null,
        "right": null,
        "args": [
          {
            "node_type": "Subscript",
            "op": null,
            "attr": null
          }
        ],
        "keywords": null
      },
      "conditions": [
        {
          "check": "target_is_name",
          "value": null,
          "index": 0,
          "name": "optimizer"
        }
      ],
      "track_as": null,
      "replacement": {
        "type": "delete_statement",
        "source": null,
        "name": null
      }
    }
  ],
  "metadata": {
    "created": "2025-11-13",
    "version": "2.0",
    "author": "LLM-Generated",
    "tier": "simple"
  }
}